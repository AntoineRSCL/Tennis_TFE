{# templates/tournament/index.html.twig #}

{% extends 'base.html.twig' %}

{% block body %}
<div class="tournamentContainer">
    <div class="listTournament">
    
        <h1>Liste des Tournois</h1>

        {# Section pour afficher les messages flash #}
        {% for label, messages in app.flashes %}
            <div class="alert alert-{{ label }}">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endfor %}

        {# Initialiser un tableau pour stocker les tournois par statut #}
        {% set tournamentsByStatus = {} %}

        {# Boucle pour regrouper les tournois par statut #}
        {% for tournament in tournaments %}
            {% if tournament.status not in tournamentsByStatus %}
                {# Initialiser le tableau pour le statut si ce n'est pas déjà fait #}
                {% set tournamentsByStatus = tournamentsByStatus | merge({ (tournament.status): [] }) %}
            {% endif %}
            {# Ajouter le tournoi au tableau correspondant au statut #}
            {% set tournamentsByStatus = tournamentsByStatus | merge({ (tournament.status): tournamentsByStatus[tournament.status] | merge([tournament]) }) %}
        {% endfor %}

        {# Affichage des tournois par statut #}
        {% for status, groupedTournaments in tournamentsByStatus %}
            <h2>{{ status }}</h2>
            <div class="tournamentList">
                {% for tournament in groupedTournaments %}
                    <div class="tournament">
                        <h3>{{ tournament.name }}</h3>
                        <p>Statut : {{ tournament.status }}</p>
                        
                        {# Si le tournoi est en phase d'inscription, afficher le bouton d'inscription #}
                        {% if tournament.status == 'Inscription' %}
                            {# Vérifier si l'utilisateur est déjà inscrit #}
                            {% if not tournamentRegistrations[tournament.id] %}
                                <a href="{{ path('tournament_register', { id: tournament.id }) }}" class="btn btn-primary">S'inscrire</a>
                            {% else %}
                                <a href="{{ path('tournament_unregister', { id: tournament.id }) }}" class="btn btn-warning">Se désinscrire</a>
                            {% endif %}
                        {% else %}
                            {# Le tournoi est soit en cours soit terminé, afficher les tableaux #}
                            <a href="{{ path('tournament_view_bracket', { id: tournament.id }) }}" class="btn btn-info">Voir les tableaux</a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
